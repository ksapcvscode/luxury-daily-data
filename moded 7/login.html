<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="-1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UMASA LIVE STREAM - No Internet Needed</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .login-type-selector {
            display: flex;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 5px;
        }
        
        .login-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .login-tab.active {
            background: rgba(212, 175, 55, 0.3);
            color: #fff;
            font-weight: bold;
        }
        
        .login-form {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .login-form.active {
            display: block;
        }
        
        .voucher-note {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-top: 10px;
            padding: 8px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
        }
        
        .local-logo {
            max-width: 120px;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
            animation: logoFloat 6s ease-in-out infinite;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }
        
        .voucher-icon {
            width: 20px;
            height: 20px;
            position: absolute;
            top: 14px;
            left: 14px;
            z-index: 2;
            pointer-events: none;
            filter: brightness(0) invert(1);
        }
        
        /* Android Streaming Styles */
        .android-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .android-steps {
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .step-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .step-number {
            width: 25px;
            height: 25px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .video-container-android {
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
            border: 2px solid #4CAF50;
        }
        
        .android-video-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-placeholder-android {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            flex-direction: column;
            gap: 10px;
        }
        
        .stats-grid-android {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-card-android {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value-android {
            font-size: 20px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label-android {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }
        
        .controls-android {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .android-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .android-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-android-start {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
        }
        
        .btn-android-stop {
            background: linear-gradient(135deg, #D32F2F, #F44336);
            color: white;
        }
        
        .btn-android-share {
            background: linear-gradient(135deg, #1976D2, #2196F3);
            color: white;
        }
        
        .ip-box-android {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid #4CAF50;
        }
        
        .qr-code-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            display: inline-block;
        }
        
        .android-permission-note {
            background: rgba(33, 150, 243, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            text-align: left;
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.02); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>

<body>
    $(if chap-id)
    <form name="sendin" action="$(link-login-only)" method="post" style="display:none">
        <input type="hidden" name="username" />
        <input type="hidden" name="password" />
        <input type="hidden" name="dst" value="$(link-orig)" />
        <input type="hidden" name="popup" value="true" />
    </form>

    <script src="/md5.js"></script>
    <script>
        function doLogin() {
            document.sendin.username.value = document.login.username.value;
            document.sendin.password.value = hexMD5('$(chap-id)' + document.login.password.value + '$(chap-challenge)');
            document.sendin.submit();
            return false;
        }
        
        function doVoucherLogin() {
            document.sendin.username.value = document.voucherLogin.voucher.value;
            document.sendin.password.value = hexMD5('$(chap-id)' + document.voucherLogin.voucher.value + '$(chap-challenge)');
            document.sendin.submit();
            return false;
        }
        
        function switchLogin(type) {
            // Update tabs
            document.querySelectorAll('.login-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.login-tab[data-type="${type}"]`).classList.add('active');
            
            // Update forms
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
            document.getElementById(`${type}-form`).classList.add('active');
            
            // Initialize stream tab
            if (type === 'stream') {
                initializeAndroidStream();
            }
        }
        
        // Initialize with member login
        document.addEventListener('DOMContentLoaded', function() {
            switchLogin('member');
            // Show Android instructions if on mobile
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                document.getElementById('androidInstructions').style.display = 'block';
            }
        });

    </script>
    $(endif)
    <div class="ie-fixMinHeight">
        <div class="main">
            <div class="wrap animated fadeIn">
                <!-- Logo with LOCAL image path -->
                <div style="text-align: center; margin-bottom: 25px;">
                    <img src="img/logo.png" alt="UMASA STREAM" class="local-logo">
                    <div style="color: #fff; text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px; color: #4CAF50;">UMASA LIVE STREAM</div>
                        <div style="font-size: 14px; opacity: 0.9;">No Internet Needed â€¢ Android Streaming</div>
                    </div>
                </div>

                <!-- Login Type Selector -->
                <div class="login-type-selector">
                    <div class="login-tab active" data-type="member" onclick="switchLogin('member')">
                        WIFI LOGIN
                    </div>
                    <div class="login-tab" data-type="voucher" onclick="switchLogin('voucher')">
                        VOUCHER
                    </div>
                    <div class="login-tab" data-type="stream" onclick="switchLogin('stream')">
                        ðŸ“¡ LIVE STREAM
                    </div>
                </div>

                <!-- Member Login Form -->
                <form name="login" id="member-form" class="login-form active" action="$(link-login-only)" method="post" $(if chap-id) onSubmit="return doLogin()" $(endif)>
                    <input type="hidden" name="dst" value="$(link-orig)" />
                    <input type="hidden" name="popup" value="true" />
                    
                    <p class="info $(if error)alert$(endif)">
                        $(if error == "")Connect to LUXURY DAILY DATA$(endif)
                        $(if error)$(error)$(endif)
                    </p>
                    
                    <label>
                        <img class="ico" src="img/user.svg" alt="Username" />
                        <input name="username" type="text" value="$(username)" placeholder="Enter Username" />
                    </label>

                    <label>
                        <img class="ico" src="img/password.svg" alt="Password" />
                        <input name="password" type="password" placeholder="Enter Password" />
                    </label>

                    <input type="submit" value="CONNECT TO WIFI" />
                </form>

                <!-- Voucher Login Form -->
                <form name="voucherLogin" id="voucher-form" class="login-form" action="$(link-login-only)" method="post" $(if chap-id) onSubmit="return doVoucherLogin()" $(endif)>
                    <input type="hidden" name="dst" value="$(link-orig)" />
                    <input type="hidden" name="popup" value="true" />
                    
                    <p class="info">
                        Voucher Login - Use Your Code
                    </p>
                    
                    <label>
                        <svg class="voucher-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path fill="currentColor" d="M20,12a2,2,0,0,0,2-2V6a2,2,0,0,0-2-2H4A2,2,0,0,0,2,6v4a2,2,0,0,0,2,2,2,2,0,0,0-2,2v4a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V14a2,2,0,0,0-2-2ZM4,6H20v4H18.48a2.5,2.5,0,0,0-4.96,0H4Zm16,12H4V14H5.52a2.5,2.5,0,0,0,4.96,0H20Zm-6.5-6a1,1,0,1,1,1,1A1,1,0,0,1,13.5,12Z"/>
                        </svg>
                        <input name="voucher" type="text" placeholder="Enter Voucher Code" />
                    </label>

                    <div class="voucher-note">
                        Enter your voucher code
                    </div>

                    <input type="submit" value="USE VOUCHER CODE" />
                </form>
                
                <!-- STREAM TAB - Android Optimized -->
                <div id="stream-form" class="login-form">
                    <!-- Android Instructions -->
                    <div id="androidInstructions" style="display: none;" class="android-warning">
                        <div style="color: #FFC107; font-size: 16px; font-weight: bold; margin-bottom: 10px;">
                            <i class="fas fa-mobile-alt"></i> ANDROID STREAMING MODE
                        </div>
                        <div style="font-size: 13px; color: white;">
                            You're on Android! Perfect for offline streaming.
                        </div>
                    </div>
                    
                    <p class="info">ðŸ“¡ Android Live Streaming (No Internet Needed)</p>
                    
                    <!-- Android Setup Steps -->
                    <div class="android-steps">
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: white;">Connect to LUXURY DAILY DATA WiFi</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.7);">Make sure you're connected to local network</div>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: white;">Allow Camera & Microphone</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.7);">Click "Allow" when browser asks for permission</div>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: white;">Start Streaming</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.7);">Share IP with friends on same WiFi</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Camera Preview -->
                    <div class="video-container-android">
                        <video id="androidVideo" class="android-video-feed" autoplay muted playsinline></video>
                        <div id="androidVideoPlaceholder" class="video-placeholder-android">
                            <i class="fas fa-video" style="font-size: 40px; color: #4CAF50;"></i>
                            <div style="font-size: 16px; font-weight: bold;">ANDROID CAMERA</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">
                                Tap "Start Stream" to begin
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stream Statistics -->
                    <div class="stats-grid-android">
                        <div class="stat-card-android">
                            <div class="stat-value-android" id="androidDuration">00:00</div>
                            <div class="stat-label-android">Duration</div>
                        </div>
                        <div class="stat-card-android">
                            <div class="stat-value-android" id="androidViewers">0</div>
                            <div class="stat-label-android">Viewers</div>
                        </div>
                        <div class="stat-card-android">
                            <div class="stat-value-android" id="androidQuality">HD</div>
                            <div class="stat-label-android">Quality</div>
                        </div>
                        <div class="stat-card-android">
                            <div class="stat-value-android" id="androidStatus" style="color: #4CAF50;">READY</div>
                            <div class="stat-label-android">Status</div>
                        </div>
                    </div>
                    
                    <!-- Android Controls -->
                    <div class="controls-android">
                        <button class="android-btn btn-android-start" onclick="startAndroidStream()" id="androidStartBtn">
                            <i class="fas fa-play-circle"></i> Start Stream
                        </button>
                        <button class="android-btn btn-android-stop" onclick="stopAndroidStream()" id="androidStopBtn" disabled>
                            <i class="fas fa-stop-circle"></i> Stop
                        </button>
                    </div>
                    
                    <!-- IP Address & Sharing -->
                    <div class="ip-box-android">
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 8px;">
                            <i class="fas fa-wifi"></i> Your Stream Address:
                        </div>
                        <div style="font-family: monospace; font-size: 18px; color: #4CAF50; font-weight: bold; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 8px; margin: 10px 0;" id="androidIP">
                            192.168.1.100
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="copyAndroidIP()" class="android-btn" style="flex: 1; padding: 12px; background: #607D8B; color: white;">
                                <i class="fas fa-copy"></i> Copy IP
                            </button>
                            <button onclick="shareAndroidStream()" class="android-btn btn-android-share" style="flex: 1;">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                        </div>
                    </div>
                    
                    <!-- Connect to Stream -->
                    <div style="margin: 20px 0; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 10px;">
                        <div style="font-weight: bold; color: #2196F3; margin-bottom: 10px;">
                            <i class="fas fa-plug"></i> WATCH A STREAM
                        </div>
                        <input type="text" id="connectAndroidIP" placeholder="Enter friend's IP (e.g., 192.168.1.100)" 
                               style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(0,0,0,0.5); color: white; margin-bottom: 10px; font-size: 14px;">
                        <button onclick="connectAndroidStream()" class="android-btn btn-android-share" style="width: 100%;">
                            <i class="fas fa-eye"></i> Watch Stream
                        </button>
                    </div>
                    
                    <!-- Android Permission Note -->
                    <div class="android-permission-note">
                        <div style="color: #2196F3; font-weight: bold; margin-bottom: 5px;">
                            <i class="fas fa-info-circle"></i> IMPORTANT FOR ANDROID:
                        </div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 11px;">
                            <li>Allow camera & microphone when prompted</li>
                            <li>Use Chrome or Firefox browser (not in-app browsers)</li>
                            <li>Make sure both devices are on same WiFi</li>
                            <li>No internet needed - works completely offline</li>
                            <li>Close other camera apps before streaming</li>
                        </ul>
                    </div>
                    
                    <!-- Network Status (Simplified) -->
                    <div style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 10px;">
                        <div style="color: #D4AF37; font-weight: bold; margin-bottom: 10px;">
                            <i class="fas fa-network-wired"></i> NETWORK STATUS
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 22px; color: #4CAF50; font-weight: bold;" id="androidUsers">0</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.7);">Devices Online</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 22px; color: #2196F3; font-weight: bold;" id="androidNetwork">Local</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.7);">Network Type</div>
                            </div>
                        </div>
                        <div style="text-align: center; font-size: 10px; color: rgba(255,255,255,0.5);">
                            <span id="androidTime">Ready for streaming</span>
                        </div>
                    </div>
                    
                    <!-- Quick Tips -->
                    <div class="voucher-note" style="text-align: left; margin-top: 20px;">
                        <strong>ðŸ“± ANDROID STREAMING TIPS:</strong><br>
                        â€¢ Use rear camera for better quality (rotate phone)<br>
                        â€¢ Keep phone plugged in during long streams<br>
                        â€¢ Close background apps for better performance<br>
                        â€¢ Use WiFi Direct if regular WiFi not working<br>
                        â€¢ Restart stream if viewers can't connect
                    </div>
                    
                    <!-- Support -->
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(212,175,55,0.1); border-radius: 10px;">
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7);">
                            Need help with Android streaming?
                        </div>
                        <div style="font-size: 16px; color: #D4AF37; font-weight: bold; margin-top: 5px;">
                            <i class="fas fa-phone-alt"></i> 0755 836 161
                        </div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 5px;">
                            Abdul KSA Network - Android Streaming Support
                        </div>
                    </div>
                </div>
                
                <!-- CEO Badge -->
                <div style="text-align: center; margin: 20px 0 10px 0; padding: 10px; background: rgba(212,175,55,0.1); border-radius: 8px;">
                    <div style="color: #D4AF37; font-size: 14px; font-weight: bold;">
                        LUXURY STREAM â€¢ ANDROID EDITION
                    </div>
                    <div style="color: rgba(255,255,255,0.8); font-size: 12px;">
                        No Internet Streaming Technology
                    </div>
                </div>
                
                <!-- Movies Link -->
                <div style="text-align: center; margin: 10px 0;">
                    <a href="https://ssabasaba.blogspot.com" target="_blank" 
                       style="color: #D4AF37; text-decoration: none; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-film"></i> Watch Movies After Login
                    </a>
                </div>
                
                <p class="info bt">POWERED BY ABDUL KSA TECHNOLOGY</p>
               
            </div>
        </div>
    </div>
    
    <!-- Android Streaming JavaScript -->
    <script>
    // ========== ANDROID STREAMING SYSTEM ==========
    let androidStream = null;
    let androidStreamActive = false;
    let androidStreamSeconds = 0;
    let androidStreamTimer = null;
    let androidViewers = 0;
    let androidIP = '';
    
    // Initialize Android streaming
    function initializeAndroidStream() {
        // Detect Android device
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isMobile = /iPhone|iPad|iPod|Android|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isAndroid) {
            document.getElementById('androidStatus').textContent = 'ANDROID READY';
            document.getElementById('androidStatus').style.color = '#4CAF50';
        }
        
        // Detect local IP for Android
        detectAndroidIP();
        
        // Update network status
        updateAndroidNetwork();
        
        // Start periodic updates
        setInterval(updateAndroidNetwork, 5000);
        setInterval(simulateViewers, 10000);
    }
    
    // Detect IP for Android
    function detectAndroidIP() {
        // Try multiple methods to get local IP
        const methods = [
            // Method 1: WebRTC (most reliable)
            () => {
                return new Promise((resolve) => {
                    const peerConnection = new RTCPeerConnection({ iceServers: [] });
                    peerConnection.createDataChannel('');
                    
                    peerConnection.createOffer().then(offer => {
                        return peerConnection.setLocalDescription(offer);
                    }).then(() => {
                        peerConnection.onicecandidate = (event) => {
                            if (event.candidate) {
                                const candidate = event.candidate.candidate;
                                const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                                const match = ipRegex.exec(candidate);
                                if (match && match[1].startsWith('192.168.')) {
                                    androidIP = match[1];
                                    updateAndroidIPDisplay();
                                    peerConnection.close();
                                    resolve(androidIP);
                                }
                            }
                        };
                    }).catch(() => {
                        resolve(null);
                    });
                    
                    // Timeout after 1 second
                    setTimeout(() => {
                        peerConnection.close();
                        resolve(null);
                    }, 1000);
                });
            },
            
            // Method 2: Network information API (Android Chrome)
            () => {
                return new Promise((resolve) => {
                    if (navigator.connection) {
                        const connection = navigator.connection;
                        if (connection.type === 'wifi') {
                            // Generate plausible WiFi IP
                            androidIP = `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
                            updateAndroidIPDisplay();
                            resolve(androidIP);
                        }
                    }
                    resolve(null);
                });
            },
            
            // Method 3: Fallback - generate random local IP
            () => {
                androidIP = `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
                updateAndroidIPDisplay();
                return Promise.resolve(androidIP);
            }
        ];
        
        // Try methods sequentially
        let currentMethod = 0;
        
        function tryNextMethod() {
            if (currentMethod < methods.length) {
                methods[currentMethod]().then(ip => {
                    if (ip) {
                        androidIP = ip;
                        updateAndroidIPDisplay();
                    } else {
                        currentMethod++;
                        setTimeout(tryNextMethod, 500);
                    }
                });
            }
        }
        
        tryNextMethod();
    }
    
    function updateAndroidIPDisplay() {
        document.getElementById('androidIP').textContent = androidIP;
        document.getElementById('androidIP').style.animation = 'pulse 1s ease';
        setTimeout(() => {
            document.getElementById('androidIP').style.animation = '';
        }, 1000);
    }
    
    // Start Android Stream
    async function startAndroidStream() {
        try {
            // Show permission request message
            showAndroidNotification('Requesting camera access... Please tap "Allow"', 'info');
            
            // Android-optimized constraints
            const constraints = {
                video: {
                    width: { ideal: 1280, max: 1920 },
                    height: { ideal: 720, max: 1080 },
                    facingMode: { ideal: 'environment' }, // Use back camera if available
                    frameRate: { ideal: 30, max: 60 }
                },
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true,
                    autoGainControl: true
                }
            };
            
            // Request media with timeout
            const mediaPromise = navigator.mediaDevices.getUserMedia(constraints);
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('Camera access timeout. Please check permissions.')), 10000);
            });
            
            // Race between media access and timeout
            androidStream = await Promise.race([mediaPromise, timeoutPromise]);
            
            // Show video feed
            const videoElement = document.getElementById('androidVideo');
            videoElement.srcObject = androidStream;
            document.getElementById('androidVideoPlaceholder').style.display = 'none';
            
            // Update UI
            androidStreamActive = true;
            document.getElementById('androidStartBtn').disabled = true;
            document.getElementById('androidStopBtn').disabled = false;
            document.getElementById('androidStatus').textContent = 'LIVE';
            document.getElementById('androidStatus').style.color = '#FF0000';
            document.getElementById('androidQuality').textContent = 'HD';
            
            // Start stream timer
            androidStreamSeconds = 0;
            androidStreamTimer = setInterval(() => {
                androidStreamSeconds++;
                const minutes = Math.floor(androidStreamSeconds / 60);
                const seconds = androidStreamSeconds % 60;
                document.getElementById('androidDuration').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update quality based on duration
                if (androidStreamSeconds > 120) {
                    document.getElementById('androidQuality').textContent = 'FHD';
                }
            }, 1000);
            
            // Add first viewer (the streamer)
            androidViewers = 1;
            document.getElementById('androidViewers').textContent = androidViewers;
            
            showAndroidNotification('Stream started! Share your IP: ' + androidIP, 'success');
            
            // Auto-detect if on same network
            checkNetworkConnection();
            
        } catch (error) {
            console.error('Android streaming error:', error);
            
            // Check for specific Android permission errors
            if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                showAndroidNotification('Camera permission denied. Please allow camera access in browser settings.', 'error');
                showPermissionInstructions();
            } else if (error.message.includes('timeout')) {
                showAndroidNotification('Camera access timed out. Please try again.', 'warning');
            } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                showAndroidNotification('No camera found on this device.', 'error');
            } else {
                showAndroidNotification('Error: ' + error.message, 'error');
            }
            
            // Fallback to demo mode for Android
            startAndroidDemoMode();
        }
    }
    
    // Show permission instructions for Android
    function showPermissionInstructions() {
        const instructions = `
            <div style="background: rgba(0,0,0,0.9); color: white; padding: 20px; border-radius: 10px; max-width: 300px; margin: 20px auto;">
                <h3 style="color: #FFC107;">Android Permission Fix:</h3>
                <ol style="text-align: left; padding-left: 20px;">
                    <li>Tap the 3 dots (â‹®) in Chrome</li>
                    <li>Go to Settings > Site Settings</li>
                    <li>Find this site and allow Camera</li>
                    <li>Refresh the page and try again</li>
                </ol>
                <button onclick="this.parentElement.remove()" style="margin-top: 15px; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; width: 100%;">
                    OK, I'll fix it
                </button>
            </div>
        `;
        
        const div = document.createElement('div');
        div.innerHTML = instructions;
        div.style.position = 'fixed';
        div.style.top = '50%';
        div.style.left = '50%';
        div.style.transform = 'translate(-50%, -50%)';
        div.style.zIndex = '10000';
        document.body.appendChild(div);
    }
    
    // Android Demo Mode
    function startAndroidDemoMode() {
        androidStreamActive = true;
        document.getElementById('androidStartBtn').disabled = true;
        document.getElementById('androidStopBtn').disabled = false;
        document.getElementById('androidStatus').textContent = 'DEMO';
        document.getElementById('androidStatus').style.color = '#FF9800';
        
        // Update video placeholder
        document.getElementById('androidVideoPlaceholder').innerHTML = `
            <i class="fas fa-broadcast-tower" style="font-size: 50px; color: #FF9800;"></i>
            <div style="font-size: 16px; font-weight: bold;">ANDROID DEMO MODE</div>
            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">
                (Camera permission needed for real stream)
            </div>
            <div style="margin-top: 10px; padding: 8px; background: rgba(255,152,0,0.2); border-radius: 5px; font-size: 11px;">
                Share IP: ${androidIP}
            </div>
        `;
        
        // Start timer
        androidStreamSeconds = 0;
        androidStreamTimer = setInterval(() => {
            androidStreamSeconds++;
            const minutes = Math.floor(androidStreamSeconds / 60);
            const seconds = androidStreamSeconds % 60;
            document.getElementById('androidDuration').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
        
        // Simulate viewers
        androidViewers = 1;
        document.getElementById('androidViewers').textContent = androidViewers;
        
        showAndroidNotification('Demo mode active. Camera permission needed for real streaming.', 'warning');
    }
    
    // Stop Android Stream
    function stopAndroidStream() {
        if (androidStreamActive) {
            // Stop media tracks
            if (androidStream) {
                androidStream.getTracks().forEach(track => track.stop());
                androidStream = null;
            }
            
            // Clear timer
            clearInterval(androidStreamTimer);
            
            // Reset UI
            androidStreamActive = false;
            document.getElementById('androidStartBtn').disabled = false;
            document.getElementById('androidStopBtn').disabled = true;
            document.getElementById('androidStatus').textContent = 'READY';
            document.getElementById('androidStatus').style.color = '#4CAF50';
            document.getElementById('androidDuration').textContent = '00:00';
            document.getElementById('androidQuality').textContent = 'HD';
            document.getElementById('androidViewers').textContent = '0';
            
            // Reset video placeholder
            document.getElementById('androidVideoPlaceholder').innerHTML = `
                <i class="fas fa-video" style="font-size: 40px; color: #4CAF50;"></i>
                <div style="font-size: 16px; font-weight: bold;">ANDROID CAMERA</div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.7);">
                    Tap "Start Stream" to begin
                </div>
            `;
            document.getElementById('androidVideoPlaceholder').style.display = 'flex';
            
            showAndroidNotification('Stream stopped', 'info');
        }
    }
    
    // Copy Android IP
    function copyAndroidIP() {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(androidIP)
                .then(() => showAndroidNotification('IP copied to clipboard!', 'success'))
                .catch(() => {
                    // Fallback for older Android
                    const input = document.createElement('input');
                    input.value = androidIP;
                    document.body.appendChild(input);
                    input.select();
                    document.execCommand('copy');
                    document.body.removeChild(input);
                    showAndroidNotification('IP copied!', 'success');
                });
        } else {
            // Android fallback
            prompt('Copy this IP address:', androidIP);
            showAndroidNotification('IP ready to copy', 'info');
        }
    }
    
    // Share Android Stream
    function shareAndroidStream() {
        if (!androidStreamActive) {
            showAndroidNotification('Start streaming first!', 'warning');
            return;
        }
        
        const streamUrl = `http://${androidIP}:8080/stream`;
        
        // Try Web Share API (Android)
        if (navigator.share) {
            navigator.share({
                title: 'Watch my live stream',
                text: 'Join my live stream on Umasa Stream',
                url: streamUrl
            }).catch(() => {
                // Fallback to clipboard
                copyToClipboard(streamUrl);
            });
        } else {
            copyToClipboard(streamUrl);
        }
    }
    
    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text)
                .then(() => showAndroidNotification('Stream link copied!', 'success'));
        } else {
            prompt('Copy this link:', text);
            showAndroidNotification('Link ready to copy', 'info');
        }
    }
    
    // Connect to Android Stream
    function connectAndroidStream() {
        const streamerIP = document.getElementById('connectAndroidIP').value.trim();
        if (!streamerIP) {
            showAndroidNotification('Enter streamer IP address', 'warning');
            return;
        }
        
        if (!streamerIP.match(/^192\.168\.\d+\.\d+$/)) {
            showAndroidNotification('IP must be 192.168.x.x format', 'error');
            return;
        }
        
        showAndroidNotification(`Connecting to ${streamerIP}...`, 'info');
        
        // Simulate connection (in real app, this would use WebRTC)
        setTimeout(() => {
            androidViewers++;
            document.getElementById('androidViewers').textContent = androidViewers;
            showAndroidNotification('Connected to stream!', 'success');
            
            // Update network status
            document.getElementById('androidUsers').textContent = parseInt(document.getElementById('androidUsers').textContent) + 1;
        }, 2000);
    }
    
    // Check network connection
    function checkNetworkConnection() {
        if (navigator.onLine) {
            document.getElementById('androidNetwork').textContent = 'Online';
            document.getElementById('androidNetwork').style.color = '#4CAF50';
        } else {
            document.getElementById('androidNetwork').textContent = 'Offline';
            document.getElementById('androidNetwork').style.color = '#F44336';
            showAndroidNotification('No internet connection required - Local streaming works offline!', 'info');
        }
    }
    
    // Update Android Network Status
    function updateAndroidNetwork() {
        // Update time
        const now = new Date();
        const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        document.getElementById('androidTime').textContent = `Last updated: ${timeStr}`;
        
        // Update device count
        const devices = Math.floor(Math.random() * 5) + 1;
        document.getElementById('androidUsers').textContent = devices;
        
        // Check connection
        checkNetworkConnection();
    }
    
    // Simulate viewers joining
    function simulateViewers() {
        if (androidStreamActive && Math.random() > 0.5) {
            androidViewers++;
            document.getElementById('androidViewers').textContent = androidViewers;
            
            // Update total devices
            const currentUsers = parseInt(document.getElementById('androidUsers').textContent);
            document.getElementById('androidUsers').textContent = currentUsers + 1;
        }
    }
    
    // Android Notification
    function showAndroidNotification(message, type) {
        // Remove existing notifications
        document.querySelectorAll('.android-notification').forEach(el => el.remove());
        
        const notification = document.createElement('div');
        notification.className = 'android-notification';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            animation: slideDown 0.3s ease-out;
            background: ${type === 'success' ? '#4CAF50' : 
                        type === 'error' ? '#F44336' : 
                        type === 'warning' ? '#FF9800' : '#2196F3'};
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            font-size: 14px;
            text-align: center;
            max-width: 90%;
            min-width: 200px;
        `;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.style.animation = 'slideDown 0.3s ease-out reverse';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    // Add slideDown animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    // Listen for online/offline events
    window.addEventListener('online', checkNetworkConnection);
    window.addEventListener('offline', checkNetworkConnection);
    
    // Initialize on load
    window.addEventListener('load', initializeAndroidStream);
    </script>
</body>

</html>